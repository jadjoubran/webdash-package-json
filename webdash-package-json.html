<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="webdash-package-json">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <h1>Packages</h1>

    <template is="dom-repeat" items="{{packages}}">
      <div>{{item.name}}: {{item.version}}</div>
    </template>
  </template>

  <script>
    /**
     * `webdash-package-json`
     * 
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class WebdashPackageJson extends Polymer.Element {
      static get is() { return 'webdash-package-json'; }

      ready() {
        super.ready();

        console.log('ready');
        //this will use a wrapper and then simply be `/package-json`
        fetch('/api/webdash-package-json/package-json')
          .then(response => response.json())
          .then(data => {
            if (!data.result) {
              return false;
            }
            console.log(data.result);
            const packages = [];

            for (const [key, value] of Object.entries(data.result)) {
              packages.push({ name: key, version: value.version });
            }
            this.packages = packages;
          })
          .catch(console.error);
      }
    }

    window.customElements.define(WebdashPackageJson.is, WebdashPackageJson);
  </script>
</dom-module>